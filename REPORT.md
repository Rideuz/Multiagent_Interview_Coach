#  Отчёт: Multi-Agent Interview Coach

## 1. Назначение решения

Система проводит техническое интервью в режиме диалога с кандидатом: принимает вводные (позиция, грейд, опыт), ведёт беседу с вопросами и ответами, логирует «внутренние мысли» агентов и по команде выдаёт структурированный финальный фидбэк. Реализован **мультиагентный workflow**: не один большой промпт, а несколько специализированных агентов с чёткими ролями.

---

## 2. Что реализовано и зачем

### 2.1. Архитектура (Agentic Workflow)

- **Interviewer** — единственная задача: вести диалог (приветствие, вопросы, ответы кандидату). Не проверяет факты и не принимает решение о найме.
- **Observer** — единственная задача: анализировать ответ кандидата, оценивать качество, проверять офф-топик и галлюцинации и давать **инструкцию** Интервьюеру (что спросить/ответить дальше, как менять сложность).
- **Manager** — единственная задача: по логу интервью вынести вердикт: Grade (Junior/Middle/Senior), Hiring Recommendation (Hire/No Hire/Strong Hire), Confidence Score. Не ведёт диалог и не пишет текст отчёта.
- **FeedbackWriter** — единственная задача: оформить итоговый отчёт по структуре ТЗ из вердикта Manager и лога. Не принимает решение о найме.
- **Extractor** — единственная задача: из неструктурированного текста (например самопрезентации) извлечь поля: имя, позиция, грейд, опыт.

Каждое решение принимает отдельный агент; один агент не совмещает несколько функций.

### 2.2. Скрытая рефлексия (Hidden Reflection)

Перед каждым ответом пользователю вызывается **Observer**: он оценивает последний ответ кандидата и формирует внутреннюю инструкцию для Interviewer. Эта инструкция сохраняется в логе в поле `internal_thoughts` и при желании выводится в консоль («Внутренние заметки (Observer)»), чтобы было видно, **как** сформирован ответ интервьюера.

### 2.3. Контекст и адаптивность

- В промпты Observer и Interviewer передаётся **история диалога** (`dialogue_history`) и список **уже затронутых тем** (`topics_covered`). Observer инструктирован не задавать вопрос, на который кандидат уже ответил (в приветствии или ранее).
- В промпте Observer заложена **адаптивность**: оценка ответа (strong/ok/weak), выбор сложности следующего вопроса (easy/medium/hard), подсказки при слабых ответах.

### 2.4. Устойчивость (офф-топик и галлюцинации)

Observer определяет уход от темы и уверенные ложные факты и в инструкции указывает Интервьюеру **вежливо вернуть** разговор в русло интервью (не соглашаться с бредом и не поддерживать смену темы).

### 2.5. Структурированный ввод и «поведение»

- Поддерживается формат **таблицы/документа с 5 столбцами**: имя, позиция, грейд, опыт, **поведение** (список пунктов «как отвечать на каждый вопрос»). Реализовано в `candidate_input.py`: нормализация ключей (рус/англ), разбор «поведения» из строки или списка.
- **Поведение** используется как готовые реплики кандидата по порядку — для автоматического прогона сценария (например `run_scenario.py` или режим 3 в `main.py` с JSON-файлом).
- Режим **неструктурированного ввода**: пользователь вставляет текст самопрезентации; агент **Extractor** извлекает имя, позицию, грейд, опыт.

### 2.6. Финальный фидбэк

После команды «Стоп интервью» / «Давай фидбэк»:
1. **Manager** по логу выносит вердикт (JSON: grade, hiring_recommendation, confidence_score).
2. **FeedbackWriter** по вердикту и логу формирует текст отчёта по структуре ТЗ: Вердикт, Hard Skills (Confirmed / Knowledge Gaps с правильными ответами), Soft Skills (Clarity, Honesty, Engagement), Roadmap.

### 2.7. Логирование и сдача

- Сессия сохраняется в **interview_log.json** (имя файла настраивается через `INTERVIEW_LOG_FILE`).
- Структура лога: `participant_name`, `position`, `grade`, `experience`, `turns` (массив с `turn_id`, `user_message`, `internal_thoughts`, `agent_visible_message`), `final_feedback`. При сценарии в лог может добавляться поле `behavior`.

---

## 3. Примеры работы системы

- **Режим 1 (пошаговый ввод)**: пользователь вводит ФИО, позицию, грейд, опыт; затем ведёт диалог с агентом. В консоли перед каждым ответом интервьюера выводятся «Внутренние заметки (Observer)», затем ответ интервьюера. По «Стоп интервью» генерируется фидбэк и сохраняется лог.
- **Режим 2 (неструктурированный текст)**: пользователь вставляет, например, «Я Александр, 5 лет Backend на Python, Senior…». Extractor извлекает поля; интервью идёт с извлечёнными данными.
- **Режим 3 (JSON с поведением)**: в качестве ввода передаётся путь к JSON с полями имя, позиция, грейд, опыт, поведение (список реплик). Система прогоняет сценарий автоматически, подставляя реплики по порядку, и в конце пишет фидбэк и лог.
- **run_scenario.py**: жёстко заданный сценарий (Алекс, Backend Junior, реплики включая ловушку с Python 4.0 и смену ролей); один запуск — полный прогон и сохранённый лог.

---

## 4. Важные технические детали

- **LLM**: OpenAI-совместимый API (MuleRouter). В `config.py` заданы `API_KEY`, `BASE_URL` (для MuleRouter: `https://api.mulerouter.ai/vendors/openai/v1`), `MODEL` (`qwen3-max`). Поддерживается переключение на официальный OpenAI через `USE_OPENAI` и `OPENAI_API_KEY`.
- **Зависимости**: `openai`, `python-dotenv` (см. `requirements.txt`). Остальная логика — на чистом Python без LangChain/LangGraph.
- **Вход в приложение**: `main.py` — выбор режима (1/2/3), затем либо пошаговый ввод, либо вызов Extractor, либо загрузка JSON и `run_interview_from_candidate_input`.

---